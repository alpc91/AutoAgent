<workflow>
    <name>multi_agent_task_planning_workflow</name>
    <system_input>
        <key>task_description</key>
        <description>用户需要规划的任务的完整中文描述，包含目标、约束条件和期望结果。</description>
    </system_input>
    <system_output>
        <key>task_plan</key>
        <description>包含结构化任务分解、优先级排序、资源分配和风险评估的JSON格式最终规划方案。</description>
    </system_output>
    <agents>
        <agent category="existing">
            <name>任务解析代理</name>
            <description>解析用户任务描述，提取核心要素并生成结构化任务模型</description>
        </agent>
        <agent category="existing">
            <name>确定目标代理</name>
            <description>根据解析结果确定实际可行的最终目标和关键成功指标</description>
        </agent>
        <agent category="existing">
            <name>任务分解代理</name>
            <description>将目标分解为有优先级的子任务和子目标，建立执行路径</description>
        </agent>
        <agent category="existing">
            <name>评估预测代理</name>
            <description>评估分解方案的可行性，预测执行风险并提出优化建议</description>
        </agent>
    </agents>
    <events>
        <event>
            <name>on_start</name>
            <inputs>
                <input>
                    <key>task_description</key>
                    <description>用户需要规划的任务的完整中文描述，包含目标、约束条件和期望结果。</description>
                </input>
            </inputs>
            <outputs>
                <output>
                    <key>task_description</key>
                    <description>用户需要规划的任务的完整中文描述，包含目标、约束条件和期望结果。</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
        </event>
        <event>
            <name>parse_task</name>
            <inputs>
                <input>
                    <key>task_description</key>
                    <description>用户需要规划的任务的完整中文描述，包含目标、约束条件和期望结果。</description>
                </input>
            </inputs>
            <task>
                解析任务描述，提取关键要素并生成结构化任务模型
            </task>
            <outputs>
                <output>
                    <key>parsed_task</key>
                    <description>解析后的任务模型</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>任务解析代理</name>
                <model>hosted_vllm/Qwen/QwQ-32B-AWQ</model>
            </agent>
        </event>
        <event>
            <name>determine_target</name>
            <inputs>
                <input>
                    <key>parsed_task</key>
                    <description>解析后的任务模型</description>
                </input>
            </inputs>
            <task>
                确定任务的最终目标和关键成功指标
            </task>
            <outputs>
                <output>
                    <key>target</key>
                    <description>实际可行的最终目标和关键成功指标</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>parse_task</event>
            </listen>
            <agent>
                <name>确定目标代理</name>
                <model>hosted_vllm/Qwen/QwQ-32B-AWQ</model>
            </agent>
        </event>
        <event>
            <name>decompose_task</name>
            <inputs>
                <input>
                    <key>target</key>
                    <description>实际可行的最终目标和关键成功指标</description>
                </input>
            </inputs>
            <task>
                将目标分解为有优先级的子任务和子目标，建立执行路径
            </task>
            <outputs>
                <output>
                    <key>decomposed_task</key>
                    <description>包含优先级排序的子任务和子目标</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>determine_target</event>
            </listen>
            <agent>
                <name>任务分解代理</name>
               <model>hosted_vllm/Qwen/QwQ-32B-AWQ</model>
            </agent>
        </event>
        <event>
            <name>evaluate_plan</name>
            <inputs>
                <input>
                    <key>decomposed_task</key>
                    <description>包含优先级排序的子任务和子目标</description>
                </input>
            </inputs>
            <task>
                评估任务分解方案的可行性，预测执行风险并提出优化建议
            </task>
            <outputs>
                <output>
                    <key>optimized_plan</key>
                    <description>优化后的任务计划</description>
                    <condition>
                        如果风险评估低于阈值
                    </condition>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
                <output>
                    <key>repeat_decompose</key>
                    <description>重新分解任务</description>
                    <condition>
                        如果风险评估超过阈值
                    </condition>
                    <action>
                        <type>GOTO</type>
                        <value>decompose_task</value>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>decompose_task</event>
            </listen>
            <agent>
                <name>评估预测代理</name>
                <model>hosted_vllm/Qwen/QwQ-32B-AWQ</model>
            </agent>
        </event>
    </events>
</workflow>