<workflow>
    <name>task_comprehensive_planning_with_goto</name>
    <system_input>
        <key>task_description</key>
        <description>需要规划的任务描述信息</description>
    </system_input>
    <system_output>
        <key>final_plan</key>
        <description>经过多次优化后的最终任务规划方案</description>
    </system_output>
    <agents>
        <agent category="existing">
            <name>任务解析智能体</name>
            <description>对任务进行详细解析并生成结构化输出的智能代理</description>
        </agent>
        <agent category="existing">
            <name>目标确定智能体</name>
            <description>根据解析结果设定实际可行目标的智能代理</description>
        </agent>
        <agent category="existing">
            <name>分解任务智能体</name>
            <description>将任务分解为多个子步骤和子目标的智能代理</description>
        </agent>
        <agent category="existing">
            <name>评估预测智能体</name>
            <description>评估任务分解结果并提出改进建议的智能代理</description>
        </agent>
    </agents>
    <events>
        <event>
            <name>on_start</name>
            <inputs>
                <input>
                    <key>task_description</key>
                    <description>需要规划的任务描述信息</description>
                </input>
            </inputs>
            <outputs>
                <output>
                    <key>task_description</key>
                    <description>需要规划的任务描述信息</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
        </event>
        <event>
            <name>parse_task</name>
            <inputs>
                <input>
                    <key>task_description</key>
                    <description>需要规划的任务描述信息</description>
                </input>
            </inputs>
            <task>对任务描述进行详细解析</task>
            <outputs>
                <output>
                    <key>parsed_task</key>
                    <description>解析后的任务结构化数据</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>on_start</event>
            </listen>
            <agent>
                <name>任务解析智能体</name>
                <model>openai/qwen-plus</model>
            </agent>
        </event>
        <event>
            <name>determine_goal</name>
            <inputs>
                <input>
                    <key>parsed_task</key>
                    <description>解析后的任务结构化数据</description>
                </input>
            </inputs>
            <task>根据解析结果设定实际可行目标</task>
            <outputs>
                <output>
                    <key>task_goals</key>
                    <description>设定的实际可行目标</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>parse_task</event>
            </listen>
            <agent>
                <name>目标确定智能体</name>
                <model>openai/qwen-plus</model>
            </agent>
        </event>
        <event>
            <name>decompose_task</name>
            <inputs>
                <input>
                    <key>task_goals</key>
                    <description>设定的实际可行目标</description>
                </input>
            </inputs>
            <task>将任务分解为多个子步骤和子目标</task>
            <outputs>
                <output>
                    <key>decomposed_steps</key>
                    <description>任务分解后的子步骤和子目标</description>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>determine_goal</event>
            </listen>
            <agent>
                <name>分解任务智能体</name>
                <model>openai/qwen-plus</model>
            </agent>
        </event>
        <event>
            <name>evaluate_plan</name>
            <inputs>
                <input>
                    <key>decomposed_steps</key>
                    <description>任务分解后的子步骤和子目标</description>
                </input>
            </inputs>
            <task>评估任务分解结果并提出改进建议</task>
            <outputs>
                <output>
                    <key>plan_approved</key>
                    <description>如果评估通过，表示计划可以执行</description>
                    <condition>如果评估结果达标</condition>
                    <action>
                        <type>RESULT</type>
                    </action>
                </output>
                <output>
                    <key>plan_needs_revision</key>
                    <description>如果评估未通过，需要重新调整目标</description>
                    <condition>如果评估结果未达标</condition>
                    <action>
                        <type>GOTO</type>
                        <value>determine_goal</value>
                    </action>
                </output>
            </outputs>
            <listen>
                <event>decompose_task</event>
            </listen>
            <agent>
                <name>评估预测智能体</name>
                <model>openai/qwen-plus</model>
            </agent>
        </event>
    </events>
</workflow>